<!doctype html>
<html lang="fr-fr" class="no-js">

  <head>
    <link href="http://gmpg.org/xfn/11" rel="profile" hreflang="fr">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
    <meta name="google-site-verification" content="JeRPv2CEcpONAy8C7dMr1nzjlpZxlxYCtt2PnuQ78g8" />
    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  
    <title>
      
        Introduction à gdb - hackndo
      
    </title>

	<link rel="stylesheet" href="/assets/css/style.css?v=1.13"> <!-- Resource style -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Signika:600"> <!-- Logo font -->
    <script src="/assets/js/modernizr.js"></script> <!-- Modernizr -->
    
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/icones/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/icones/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/icones/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/icones/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/icones/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/icones/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/icones/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/icones/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icones/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icones/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icones/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/icones/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icones/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/res/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/icones/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
  	
	<!-- RSS -->
    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="hackndo" />

    <!-- Twitter card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@hackanddo" />
    <meta name="twitter:creator" content="@hackanddo" />
    <meta name="twitter:title" content="Introduction à gdb" />
    <meta name="twitter:description" content="GDB est un outil extrêmement puissant. Voici un article qu l'introduit avec une mise en pratique." />
    
    <meta name="twitter:image" content="http://localhost:4000/assets/uploads/2015/05/gdb_visual.jpg" />
    
  
    <!-- Google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  
      ga('create', 'UA-80312745-1', 'auto');
      ga('send', 'pageview');
  
    </script>
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Introduction à gdb" />
<meta name="author" content="Pixis" />
<meta property="og:locale" content="fr_FR" />
<meta name="description" content="GDB est un outil extrêmement puissant. Voici un article qu l’introduit avec une mise en pratique." />
<meta property="og:description" content="GDB est un outil extrêmement puissant. Voici un article qu l’introduit avec une mise en pratique." />
<link rel="canonical" href="http://localhost:4000/introduction-a-gdb/" />
<meta property="og:url" content="http://localhost:4000/introduction-a-gdb/" />
<meta property="og:site_name" content="hackndo" />
<meta property="og:image" content="http://localhost:4000/assets/uploads/2015/05/gdb_visual.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-05-17T00:00:00+02:00" />
<script type="application/ld+json">
{"image":"http://localhost:4000/assets/uploads/2015/05/gdb_visual.jpg","@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/icones/logo.png"},"name":"Pixis"},"url":"http://localhost:4000/introduction-a-gdb/","headline":"Introduction à gdb","dateModified":"2015-05-17T00:00:00+02:00","datePublished":"2015-05-17T00:00:00+02:00","author":{"@type":"Person","name":"Pixis"},"description":"GDB est un outil extrêmement puissant. Voici un article qu l’introduit avec une mise en pratique.","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/introduction-a-gdb/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

  <body>
    <header class="cd-main-header">
    <a href="/" class="cd-logo"><img src="/assets/icones/logo.png" /> <span class="cd-logo-title">hackndo</span></a>
		
    <a href="#0" class="cd-nav-trigger">Menu<span></span></a>

</header> <!-- .cd-main-header -->
    <main class="cd-main-content">
		<nav class="cd-side-nav">
            <div class="sidebar-about">
    <h1>
        <img id="site-logo" src="/assets/icones/logo.png" alt="logo" title="logo" />
        <a class="sidebar-title" href="/">
        hackndo
        </a>
    </h1>
    <p class="lead">Think out of the box</p>
</div>

<ul>
    <li class="cd-label">Blog</li>
    <li class="">
        <a href="/">Home</a>
    </li>
    
    
        
            
        
    
        
            
                <li class="">
                    <a href="/about/">À propos</a>
                </li>
            
        
    
        
            
                <li class="">
                    <a href="/archives/">Archives</a>
                </li>
            
        
    
        
            
                <li class="">
                    <a href="/contact/">Me contacter</a>
                </li>
            
        
    
        
            
                <li class="">
                    <a href="/disclaimer/">Disclaimer</a>
                </li>
            
        
    
        
    
        
            
        
    
        
            
                <li class="">
                    <a href="/projects/">Projets</a>
                </li>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
    
        
    
</ul>
<ul>
    <li class="cd-label">Liens</li>
    <li><a href="https://www.dailysecurity.fr/" target="_blank">Blog de Geluchat</a></li>
    <li><a href="http://lsdsecdaemon.com" target="_blank">Blog de Th3_l5D</a></li>
    <li><a href="http://inf0sec.fr" target="_blank">Blog de Matthieu</a></li>
</ul>
<p class="sidebar-copyright">&copy; 2019. Tous droits réservés.</p>
<div class="sidebar-social">
<ul>
  <li><a href="https://twitter.com/HackAndDo" title="Twitter" target="_blank"><img alt="Twitter" title="Twitter" src="/assets/icones/social/twitter.png" /></a></li>
  <li><a href="https://github.com/hackndo" title="Github" target="_blank"><img title="Github" alt="Github" src="/assets/icones/social/github.png" /></a></li>
  <li><a href="https://www.youtube.com/channel/UC9WYWHLdu9TK-0Hu3wcHJ9g" title="Youtube" target="_blank"><img title="Youtube" alt="Youtube" src="/assets/icones/social/youtube.png" /></a></li>
  <li><a href="https://discord.gg/9At6SUZ" title="Discord" target="_blank"><img title="Discord" alt="Discord" src="/assets/icones/social/discord.png" /></a></li>
  <li><a href="https://www.linkedin.com/in/romainbentz/" title="LinkedIn" target="_blank"><img title="LinkedIn" alt="LinkedIn" src="/assets/icones/social/linkedin.png" /></a></li>
  <li><a href="https://sh.hackndo.com" title="Shell" target="_blank"><img title="Shell" alt="Shell" src="/assets/icones/social/shell.png" /></a></li>
  <li><a href="/feed.xml" title="RSS" target="_blank"><img title="RSS" alt="RSS" src="/assets/icones/social/rss.png" /></a></li>
  <li><a href="https://ko-fi.com/hackndo" title="Ko-Fi" target="_blank"><img title="Ko-Fi" alt="Ko-Fi" src="/assets/icones/social/kofi.gif" /></a></li>
</ul>
</div>
        </nav>

        <div class="content-wrapper">
            <div class="post">
  
  <div class="post-cover">
    <img src="/assets/uploads/2015/05/gdb_visual.jpg" alt="Introduction à gdb" title="Introduction à gdb" />
  </div>
  
  <h1 class="post-title">Introduction à gdb</h1>
  <div class="post-info">
      <p class="alignleft">17 May 2015 <a class="post-comments-count" href="http://http://localhost:4000/introduction-a-gdb/#disqus_thread"></a></p>
      <p class="alignright">Auteur : <strong><a href="https://twitter.com/HackAndDo">Pixis</a></strong></p>
      <div class="keywords">
        <span class="post-tags"><a href="/archives/#linux"><i class="fas fa-tags"></i> Linux</a></span>
      </div>
</div>

  <article>
  <p>Que le programmeur qui n’a jamais mis des <code class="highlighter-rouge">printf</code>, <code class="highlighter-rouge">var_dump</code>, <code class="highlighter-rouge">echo</code>, <code class="highlighter-rouge">print</code>, <code class="highlighter-rouge">System.out</code>, <code class="highlighter-rouge">console.log</code>, <code class="highlighter-rouge">cout</code> plein son code pour savoir d’où venait un bug se dénonce. Que le programmeur qui ne s’est jamais arraché les cheveux pour un programme qui plantait violemment sans crier garde me jette la pierre (C’est une expression, hein !). Heureusement, il existe pléthore de débogueurs (<em>debuggers</em>), libres ou non, dont un qui est particulièrement reconnu, le débogueur de GNU nommé <strong>GDB</strong> (GNU Project Debugger), que nous allons introduire dans cette introduction.</p>

<!--more-->

<p>Rapidement, un debugger permet de lancer un programme, placer des points d’arrêt (<em>breakpoints</em>) à certains endroits, parfois sous certaines conditions, exécuter les instructions pas à pas, étudier et modifier la mémoire (RAM, Registres) … Bref, tous les outils essentiels pour pouvoir étudier correctement le comportement d’un programme.</p>

<p>GDB est portable (cross-platform), donc les commandes que nous allons voir ici pourront être effectuées sur tous les OS pourvu que GDB soit installé, et les exemples pris ici ont été effectués sur Linux. C’est un outil très puissant, avec de nombreuses fonctionnalités qu’il serait difficile de lister et expliquer exhaustivement, c’est pourquoi nous verrons ici ce qui me paraissait être le plus important (… parmi les fonctionnalités que je connais. Si vous en connaissez d’autres ou des astuces permettant d’accélérer/simplifier des choses, n’hésitez pas à m’en faire part dans les commentaires, je les intégrerai dans cet article).</p>

<h1 id="lancement">Lancement</h1>

<p>Il existe différentes manières de lancer gdb et de charger un binaire dans une session gdb, voici quelques commandes utiles</p>

<h2 id="hors-gdb">Hors gdb</h2>

<p>Pour lancer gdb, rien de plus simple. Dans un shell/terminal/console, lancez la commande suivante</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gdb

<span class="o">(</span>gdb<span class="o">)</span>
</code></pre></div></div>

<p>Cette commande permet de lancer une session gdb. Pour l’instant, aucun programme n’est chargé dans gdb. Mais déjà, nous pouvons faire des choses qui nous serons utiles tout au long de nos debug. Pour avoir la liste des commandes disponibles, il suffit de lancer la commande <strong>help</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">help
</span>List of classes of commands:

aliases <span class="nt">--</span> Aliases of other commands
breakpoints <span class="nt">--</span> Making program stop at certain points
data <span class="nt">--</span> Examining data
files <span class="nt">--</span> Specifying and examining files
internals <span class="nt">--</span> Maintenance commands
obscure <span class="nt">--</span> Obscure features
running <span class="nt">--</span> Running the program
stack <span class="nt">--</span> Examining the stack
status <span class="nt">--</span> Status inquiries
support <span class="nt">--</span> Support facilities
tracepoints <span class="nt">--</span> Tracing of program execution without stopping the program
user-defined <span class="nt">--</span> User-defined commands

Type <span class="s2">"help"</span> followed by a class name <span class="k">for </span>a list of commands <span class="k">in </span>that class.
Type <span class="s2">"help all"</span> <span class="k">for </span>the list of all commands.
Type <span class="s2">"help"</span> followed by <span class="nb">command </span>name <span class="k">for </span>full documentation.
Type <span class="s2">"apropos word"</span> to search <span class="k">for </span>commands related to <span class="s2">"word"</span><span class="nb">.</span>
Command name abbreviations are allowed <span class="k">if </span>unambiguous.
<span class="o">(</span>gdb<span class="o">)</span>
</code></pre></div></div>

<p>Voici d’autres commandes :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Charge le binaire "binary" dans gdb</span>
gdb binary

<span class="c"># Charge le binaire "binary" avec les arguments "args..."</span>
gdb <span class="nt">--args</span> &lt;binary&gt; &lt;args...&gt;

<span class="c"># Lance gdb qui s'attache par la suite au processus PID avec les symboles du binaire "binary"</span>
gdb <span class="nt">--pid</span> &lt;PID&gt; <span class="nt">--symbols</span> &lt;binary&gt;
</code></pre></div></div>

<h2 id="dans-gdb">Dans gdb</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Envoyer les arguments au binaire qui va être lancé</span>
<span class="o">(</span>gdb<span class="o">)</span> <span class="nb">set </span>args &lt;args...&gt;

<span class="c"># Lancer le binaire</span>
<span class="o">(</span>gdb<span class="o">)</span> run

<span class="c"># Lancer le binaire, et lui envoyer un flux dans stdin</span>
<span class="o">(</span>gdb<span class="o">)</span> r &lt; &lt;<span class="o">(</span>perl <span class="nt">-e</span> <span class="s1">'print "A"x5'</span><span class="o">)</span>

<span class="c"># Tuer le binaire en cours</span>
<span class="o">(</span>gdb<span class="o">)</span> <span class="nb">kill</span>
</code></pre></div></div>

<h1 id="calculs">Calculs</h1>

<p>Avant de s’occuper des binaires, gdb permet d’effectuer des calculs très simplement, dans différentes bases les plus utilisées (binaire, octale, hexa, décimale) et même d’afficher les caractères correspondants aux valeurs ASCII.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># On peut afficher les variables sous différents formats, de la manière suivante : p/&lt;format&gt;</span>
<span class="c"># Les formats les plus employés sont</span>
<span class="c"># c    Caractère</span>
<span class="c"># f    Float</span>
<span class="c"># o    Octal</span>
<span class="c"># s    Chaine de caractères</span>
<span class="c"># t    Binaire</span>
<span class="c"># x    Hexadécimal</span>

<span class="o">(</span>gdb<span class="o">)</span> p 10+12
<span class="nv">$1</span> <span class="o">=</span> 22
<span class="o">(</span>gdb<span class="o">)</span> p/x 10+12
<span class="nv">$2</span> <span class="o">=</span> 0x16
<span class="o">(</span>gdb<span class="o">)</span> p 0x10
<span class="nv">$3</span> <span class="o">=</span> 16
<span class="o">(</span>gdb<span class="o">)</span> p 0x10 + 10
<span class="nv">$4</span> <span class="o">=</span> 26
<span class="o">(</span>gdb<span class="o">)</span> p/x 0x10 + 10
<span class="nv">$5</span> <span class="o">=</span> 0x1a
<span class="o">(</span>gdb<span class="o">)</span> p/t 12
<span class="nv">$6</span> <span class="o">=</span> 1100
</code></pre></div></div>

<h1 id="informations">Informations</h1>

<p>Quelques informations nécessaires lorsque vous avez chargé un binaire et que vous êtes en train de le déboguer</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#disassemble : Renvoie le code assembleur correspondant aux instructions hexadécimales du binaire</span>
<span class="o">(</span>gdb<span class="o">)</span> disas ma_fonction

<span class="c">#info registers : Renvoie les informations des registres à l'instant t</span>
<span class="o">(</span>gdb<span class="o">)</span> i r

<span class="c">#info breakpoints : Permet de lister les breakpoints et leurs états</span>
<span class="o">(</span>gdb<span class="o">)</span> i b
</code></pre></div></div>

<h1 id="affichage">Affichage</h1>

<h2 id="syntaxe">Syntaxe</h2>

<p>Comme expliqué dans l’article sur les <a href=".././assembleur-notions-de-base/">notions de base d’assembleur</a>, il existe deux syntaxes pour lire de l’assembleur : AT&amp;T et Intel. Pour passer de l’une à l’autre, voici comment faire :</p>

<h3 id="att">AT&amp;T</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">set </span>disassembly-flavor att
<span class="o">(</span>gdb<span class="o">)</span> disass main
Dump of assembler code <span class="k">for function </span>main:
   0x080483f2 &lt;+0&gt;:    push   %ebp
   0x080483f3 &lt;+1&gt;:    mov    %esp,%ebp
   ...
End of assembler dump.
</code></pre></div></div>

<h3 id="intel">Intel</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">set </span>disassembly-flavor intel
<span class="o">(</span>gdb<span class="o">)</span> disass main
Dump of assembler code <span class="k">for function </span>main:
0x080483f2 &lt;+0&gt;:    push   ebp
0x080483f3 &lt;+1&gt;:    mov    ebp,esp
...
End of assembler dump.
</code></pre></div></div>

<h2 id="debug">Debug</h2>

<p>Lors d’une phase de debug, il peut être utile d’avoir sous les yeux le code machine qui s’exécute ainsi que l’état des différents registres.</p>

<p><em>Notez cependant que si vous utilisez ces fenêtres, vous ne serez plus en mesure d’utiliser la flèche du haut pour revenir dans votre historique, puisque les flèches haut et bas servent à monter et descendre dans la fenêtre affichant le code assembleur.</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Permet d'ouvrir deux fenêtre console.</span>
<span class="c"># L'une affiche le code assembleur</span>
<span class="o">(</span>gdb<span class="o">)</span> layout asm
<span class="c"># L'autre affiche l'état des registres.</span>
<span class="o">(</span>gdb<span class="o">)</span> layout regs
<span class="c"># Si un registre change lorsqu'on avance d'une instruction, il est mis en surbrillance.</span>
</code></pre></div></div>

<p>Voici un exemple du rendu :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──Register group: general─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│eax            0xbff73ef4       <span class="nt">-1074315532</span>         ecx            0x86c2e41d       <span class="nt">-2034047971</span>         edx            0x1      1                           ebx            0xb76f0ff4       <span class="nt">-1217458188</span>           │
│esp            0xbff73e40       0xbff73e40          ebp            0xbff73e48       0xbff73e48          esi            0x0      0                           edi            0x0      0                             │
│eip            0x8048826        0x8048826 &lt;main+6&gt;  eflags         0x282    <span class="o">[</span> SF IF <span class="o">]</span>                   cs             0x23     35                          ss             0x2b     43                            │
│ds             0x2b     43                          es             0x2b     43                          fs             0x0      0                           gs             0x63     99                            │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                  │
   ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
B+ │0x8048823 &lt;main+3&gt;      and    esp,0xfffffff0                                                                                                                                                                  │
  <span class="o">&gt;</span>│0x8048826 &lt;main+6&gt;      sub    esp,0x150                                                                                                                                                                       │
   │0x804882c &lt;main+12&gt;     mov    eax,0x80487fc                                                                                                                                                                   │
   │0x8048831 &lt;main+17&gt;     mov    DWORD PTR <span class="o">[</span>esp+0x4],eax                                                                                                                                                         │
   │0x8048835 &lt;main+21&gt;     mov    DWORD PTR <span class="o">[</span>esp],0x11                                                                                                                                                            │
   │0x804883c &lt;main+28&gt;     call   0x8048510 &lt;signal@plt&gt;                                                                                                                                                          │
   │0x8048841 &lt;main+33&gt;     mov    DWORD PTR <span class="o">[</span>esp+0x8],0x0                                                                                                                                                         │
   │0x8048849 &lt;main+41&gt;     mov    DWORD PTR <span class="o">[</span>esp+0x4],0x1                                                                                                                                                         │
   │0x8048851 &lt;main+49&gt;     mov    DWORD PTR <span class="o">[</span>esp],0x2                                                                                                                                                             │
   │0x8048858 &lt;main+56&gt;     call   0x80485b0 &lt;socket@plt&gt;                                                                                                                                                          │
   │0x804885d &lt;main+61&gt;     mov    DWORD PTR <span class="o">[</span>esp+0x13c],eax                                                                                                                                                       │
   │0x8048864 &lt;main+68&gt;     cmp    DWORD PTR <span class="o">[</span>esp+0x13c],0x0                                                                                                                                                       │
   │0x804886c &lt;main+76&gt;     jns    0x8048886 &lt;main+102&gt;                                                                                                                                                            │
   │0x804886e &lt;main+78&gt;     mov    DWORD PTR <span class="o">[</span>esp],0x8048ad2                                                                                                                                                       │
   │0x8048875 &lt;main+85&gt;     call   0x8048590 &lt;perror@plt&gt;                                                                                                                                                          │
   │0x804887a &lt;main+90&gt;     mov    DWORD PTR <span class="o">[</span>esp],0x1                                                                                                                                                             │
   │0x8048881 &lt;main+97&gt;     call   0x8048610 &lt;<span class="nb">exit</span>@plt&gt;                                                                                                                                                            │
   └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
child process 20368 In: main                                                                                                                                                               Line: ??   PC: 0x8048826
<span class="o">(</span>gdb<span class="o">)</span> ni
</code></pre></div></div>

<h1 id="breakpoints">Breakpoints</h1>

<p>Les breakpoints sont extrêmement puissants. Ils permettent de mettre en pause l’exécution du programme lorsqu’ils sont rencontrés. Cela permet d’étudier la mémoire à un instant très précis, quand ça nous intéresse. En effet, souvent il y a des millions d’instructions exécutées avant l’appel de la fonction qui nous intéresse, donc mettre à breakpoint au bon endroit fait gagner <strong>énormément</strong> de temps.</p>

<h2 id="sans-conditions">Sans conditions</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">break </span>main
Breakpoint 1 at 0x80483f8
<span class="o">(</span>gdb<span class="o">)</span> <span class="nb">break</span> <span class="k">*</span>0x08048400
Breakpoint 2 at 0x8048400
<span class="o">(</span>gdb<span class="o">)</span> delete 1
<span class="o">(</span>gdb<span class="o">)</span> i b
Num     Type           Disp Enb Address    What
2       breakpoint     keep y   0x08048400 &lt;main+14&gt;
<span class="o">(</span>gdb<span class="o">)</span> disable 2
<span class="o">(</span>gdb<span class="o">)</span> <span class="nb">enable </span>2
<span class="o">(</span>gdb<span class="o">)</span> i b
Num     Type           Disp Enb Address    What
2       breakpoint     keep n   0x08048400 &lt;main+14&gt;
<span class="o">(</span>gdb<span class="o">)</span> delete breakpoints
Delete all breakpoints? <span class="o">(</span>y or n<span class="o">)</span> y
</code></pre></div></div>

<h2 id="avec-conditions">Avec conditions</h2>

<p>Soit le programme C suivant :</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"Boucle ..."</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Après compilation, nous le chargeons dans gdb, et nous le désassemblons</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc boucle.c <span class="nt">-std</span><span class="o">=</span>c99 <span class="nt">-m32</span> <span class="nt">-o</span> boucle
<span class="nv">$ </span>gdb boucle
<span class="o">(</span>gdb<span class="o">)</span> <span class="nb">set </span>disassembly-flavor intel
<span class="o">(</span>gdb<span class="o">)</span> disas main
Dump of assembler code <span class="k">for function </span>main:
   0x0804840c &lt;+0&gt;:     push   ebp
   0x0804840d &lt;+1&gt;:     mov    ebp,esp
   0x0804840f &lt;+3&gt;:     and    esp,0xfffffff0
   0x08048412 &lt;+6&gt;:     sub    esp,0x20
   0x08048415 &lt;+9&gt;:     mov    DWORD PTR <span class="o">[</span>esp+0x1c],0x0
   0x0804841d &lt;+17&gt;:    jmp    0x8048430 &lt;main+36&gt;
   0x0804841f &lt;+19&gt;:    mov    DWORD PTR <span class="o">[</span>esp],0x80484d0
   0x08048426 &lt;+26&gt;:    call   0x80482f0 &lt;puts@plt&gt;
   0x0804842b &lt;+31&gt;:    add    DWORD PTR <span class="o">[</span>esp+0x1c],0x1
   0x08048430 &lt;+36&gt;:    cmp    DWORD PTR <span class="o">[</span>esp+0x1c],0x9
   0x08048435 &lt;+41&gt;:    jle    0x804841f &lt;main+19&gt;
   0x08048437 &lt;+43&gt;:    mov    eax,0x0
   0x0804843c &lt;+48&gt;:    leave
   0x0804843d &lt;+49&gt;:    ret
End of assembler dump.
</code></pre></div></div>

<p>A la ligne <code class="highlighter-rouge">+31</code>, nous voyons le compteur de notre programme qui s’incrémente. Ici, la boucle est répétée 10 fois, mais il est possible qu’elle soit répétée des millions de fois. Cependant, nous ne voulons voir la comparaison à la ligne <code class="highlighter-rouge">+36</code> que pour la dernière boucle. Pour cela, nous allons mettre un breakpoint conditionnel : Nous ne breakerons dessus que si le contenu de <code class="highlighter-rouge">esp+0x1c</code> vaut 10 (donc <code class="highlighter-rouge">0xa</code>)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> b <span class="k">*</span>0x08048430 <span class="k">if</span> <span class="k">*</span><span class="o">(</span>int<span class="k">*</span><span class="o">)(</span><span class="nv">$esp</span>+0x1c<span class="o">)</span> <span class="o">==</span> 0xa
Breakpoint 1 at 0x8048430
<span class="o">(</span>gdb<span class="o">)</span> r
Starting program: /home/betezed/blog/exemples/boucle
Boucle ...
Boucle ...
Boucle ...
Boucle ...
Boucle ...
Boucle ...
Boucle ...
Boucle ...
Boucle ...
Boucle ...

Breakpoint 1, 0x08048430 <span class="k">in </span>main <span class="o">()</span>
<span class="o">(</span>gdb<span class="o">)</span> x/x <span class="nv">$esp</span>+0x1c
0xbffff39c:    0x0000000a
</code></pre></div></div>

<p>Ce qui aurait pu être fait également de la manière suivante :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> b <span class="k">*</span>0x08048430
Breakpoint 1 at 0x8048430
<span class="o">(</span>gdb<span class="o">)</span> cond 1 <span class="k">*</span><span class="o">(</span>int<span class="k">*</span><span class="o">)(</span><span class="nv">$esp</span>+0x1c<span class="o">)</span> <span class="o">==</span> 0xa
</code></pre></div></div>

<p>Et pour enlever les conditions sur un breakpoint :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> cond 1
Breakpoint 1 now unconditional.
</code></pre></div></div>

<h1 id="pas-à-pas">Pas à pas</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># nexti : Permet d'avancer d'une (ou &lt;step&gt;) instruction(s), et si c'est un call, le call est exécuté</span>
<span class="c"># jusqu'à son retour.</span>
<span class="o">(</span>gdb<span class="o">)</span> ni &lt;step&gt;
<span class="c"># stepi : Permet d'avancer d'une (ou &lt;step&gt;) instruction(s), en rentrant dans les calls</span>
<span class="o">(</span>gdb<span class="o">)</span> si &lt;step&gt;
<span class="c"># continue : Permet de continuer jusqu'au prochain breakpoint</span>
<span class="o">(</span>gdb<span class="o">)</span> c
</code></pre></div></div>

<h1 id="fonctions">Fonctions</h1>

<p>Il est possible de définir des fonctions au sein de gdb, permettant de simplifier la répétition d’un ensemble de commandes, ou encore de boucler jusqu’à ce qu’une condition soit vérifiée. Pour cela, il faut lancer la commande <code class="highlighter-rouge">define &lt;ma_fonction&gt;</code> puis indiquer les instructions voulues, et terminer par <code class="highlighter-rouge">end</code>. Comme les exemples valent toujours mieux que les beaux discours :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> define init_mes_params
Type commands <span class="k">for </span>definition of <span class="s2">"init_mes_params"</span><span class="nb">.</span>
End with a line saying just <span class="s2">"end"</span><span class="nb">.</span>
<span class="o">&gt;</span><span class="nb">set </span>disassembly-flavor intel
<span class="o">&gt;</span><span class="nb">break </span>main
<span class="o">&gt;</span>r
<span class="o">&gt;</span>i r
<span class="o">&gt;</span>x/24xw <span class="nv">$esp</span>
<span class="o">&gt;</span>end
<span class="o">(</span>gdb<span class="o">)</span> init_mes_params
Breakpoint 1 at 0x804840f

Breakpoint 1, 0x0804840f <span class="k">in </span>main <span class="o">()</span>
eax            0xbffff454    -1073744812
ecx            0xe97a4d24    -377860828
edx            0x1    1
ebx            0xb7fcfff4    -1208156172
esp            0xbffff3a8    0xbffff3a8
ebp            0xbffff3a8    0xbffff3a8
esi            0x0    0
edi            0x0    0
eip            0x804840f    0x804840f &lt;main+3&gt;
eflags         0x246    [ PF ZF IF <span class="o">]</span>
cs             0x23    35
ss             0x2b    43
ds             0x2b    43
es             0x2b    43
fs             0x0    0
gs             0x63    99
0xbffff3a8:    0xbffff428    0xb7e85e46    0x00000001    0xbffff454
0xbffff3b8:    0xbffff45c    0xb7fd4000    0x08048320    0xffffffff
0xbffff3c8:    0xb7ffeff4    0x08048252    0x00000001    0xbffff410
0xbffff3d8:    0xb7ff06d6    0xb7fffad0    0xb7fd42e8    0xb7fcfff4
0xbffff3e8:    0x00000000    0x00000000    0xbffff428    0xc6213b34
0xbffff3f8:    0xe97a4d24    0x00000000    0x00000000    0x00000000
<span class="o">(</span>gdb<span class="o">)</span>
</code></pre></div></div>

<p>Il est possible d’utiliser les structures de contrôles, telles que</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="k">if</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
<span class="o">&gt;</span>     <span class="n">commandes</span><span class="p">...</span>
<span class="o">&gt;</span> <span class="n">end</span>
<span class="o">&gt;</span> <span class="k">while</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
<span class="o">&gt;</span>     <span class="n">commandes</span><span class="p">...</span>
<span class="o">&gt;</span> <span class="n">end</span>
</code></pre></div></div>

<h1 id="gdbinit">.gdbinit</h1>

<p>Bien sûr, avec toutes ces informations, vous pouvez vous créer votre petit environnement gdb qui satisfait vos besoins et vos préférences, mais vous n’allez évidemment pas taper toutes les commandes à chaque fois. Il est très fastidieux de devoir taper, à chaque lancement de gdb, les commandes permettant de changer de syntaxe, de breaker sur la fonction main, de désassembler le binaire, d’étudier la pile, si c’est ce que vous voulez faire à chaque fois que vous ouvrez gdb (mais libre à vous de choisir ce que vous voulez)</p>

<p>Pour cela, il vous suffit de créer un fichier <code class="highlighter-rouge">.gdbinit</code> dans le même dossier depuis lequel vous lancez gdb, et dans ce fichier, vous mettez ligne après ligne les commandes que vous souhaitez lancer. Par exemple :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat</span> .gdbinit
<span class="c"># Pour toujours avoir la syntaxe intel</span>
<span class="nb">set </span>disassembly-flavor intel

<span class="c"># Pour que lors d'un fork, gdb suive le processus enfant, plutôt que le processus parent</span>
<span class="nb">set </span>follow-fork-mode child

<span class="c"># Si vous savez que vous devez lancer gdb plusieurs fois pour le binaire que</span>
<span class="c"># vous êtes en train de débuguer, et que les 9 première itérations d'une boucle</span>
<span class="c"># ne vous importent pas, autant breaker tout de suite au moment qui vous intéresse</span>
b <span class="k">*</span>0x8048705 <span class="k">if</span> <span class="k">*</span><span class="o">(</span>int<span class="k">*</span><span class="o">)(</span><span class="nv">$esp</span>+0x10<span class="o">)</span> <span class="o">==</span> 0xa

<span class="c"># Et lancer le binaire</span>
r

<span class="c"># Ensuite, nous voulons souvent utiliser ces deux fonctions en même temps</span>
<span class="c"># Autant les regrouper dans une même fonction !</span>
define afficher_layouts
layout asm
layout regs
end
<span class="nv">$ </span>
</code></pre></div></div>

<p>Et pour finir, sachez que si vous avez votre <code class="highlighter-rouge">.gdbinit</code>, mais que vous ne voulez pas l’utiliser pour votre prochaine session gdb, il suffit de passer l’argument <code class="highlighter-rouge">-nx</code> à gdb pour lui demander d’ignorer ce fichier.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gdb &lt;binary&gt; <span class="nt">-nx</span>
</code></pre></div></div>

<p>Voilà, avec cette introduction à gdb, vous devriez pouvoir l’utiliser et profiter de sa force. Il manque un tas de choses, j’en suis conscient, et j’ajouterai des fonctions qui me paraitront pertinentes, que ce soit en les découvrant par moi-même, ou par vos commentaires !</p>

<h1 id="pour-aller-plus-loin-">Pour aller plus loin …</h1>

<p>Si vous sentez que gdb est trop morne, qu’il manque de couleurs, de fonctionnalités, sachez que de nombreuses initiatives existent dans le monde open source afin de vous rendre la vie plus agréable, en vous proposant des <code class="highlighter-rouge">.gdbinit</code> remarquablement complets et utiles. (<em>Merci à yaap pour les liens</em>) Nous pouvons citer, entre autre :`</p>

<ul>
  <li><a href="https://github.com/longld/peda" target="blank">peda</a></li>
  <li><a href="https://github.com/dholm/dotgdb" target="blank">dotgdb</a></li>
</ul>

<p>N’hésitez pas à les installer, et les modifier selon vos besoins, vous avez (presque) toutes les clés en main pour comprendre comment ils fonctionnent. Notez cependant que ces outils ne sont pas exempts de bugs ou de comportements inattendus. Utilisez les avec discernement, n’hésitez pas à être bon critique !</p>

<p>Bon reverse 😉</p>

  </article>
</div>
<div class="keywords">
    <span class="post-tags"><a href="/archives/#linux"><i class="fas fa-tags"></i> Linux</a></span>
  </div>


<br />
<div class="box">
  <div class="dash">
    <div class="picture">
      <img src="/assets/icones/pixis_logo.png" alt="logo" title="logo" />
    </div>
    <div class="box_content">
      <strong>Auteur</strong> : <a href="/contact/" target="_blank">Pixis</a><br />
      Créateur du blog, suivez-moi sur <a href="https://twitter.com/HackAndDo/" target="_blank">twitter</a> ou <a href="https://discord.gg/9At6SUZ" target="blank">discord</a>
    </div>
    
  </div>
</div>


<div class="related">
  <h2>Articles similaires</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/pass-the-hash/">
            Pass the Hash
            <small>18 Dec 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/remote-lsass-dump-passwords/">
            Extraction des secrets de lsass à distance
            <small>28 Nov 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/bloodhound/">
            BloodHound
            <small>30 Jul 2019</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    
    var disqus_config = function () {
        this.page.url = 'http://localhost:4000/introduction-a-gdb/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '0000-0000-0000-0009';
    };
    
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//hackndo.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

        </div>
    </main>
    <script src="/assets/js/jquery-2.1.4.js"></script>
    <script src="/assets/js/jquery.menu-aim.js"></script>
    <script src="/assets/js/anchor.min.js"></script>
    <script src="/assets/js/main.js"></script> <!-- Resource jQuery -->
  </body>
</html>