<!doctype html>
<html lang="fr-fr" class="no-js">

  <head>
    <link href="http://gmpg.org/xfn/11" rel="profile" hreflang="fr">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
    <meta name="google-site-verification" content="JeRPv2CEcpONAy8C7dMr1nzjlpZxlxYCtt2PnuQ78g8" />
    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  
    <title>
      
        sh vs bash - hackndo
      
    </title>

	<link rel="stylesheet" href="/assets/css/style.css?v=1.13"> <!-- Resource style -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Signika:600"> <!-- Logo font -->
    <script src="/assets/js/modernizr.js"></script> <!-- Modernizr -->
    
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/icones/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/icones/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/icones/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/icones/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/icones/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/icones/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/icones/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/icones/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icones/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icones/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icones/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/icones/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icones/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/res/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/icones/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
  	
	<!-- RSS -->
    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="hackndo" />

    <!-- Twitter card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@hackanddo" />
    <meta name="twitter:creator" content="@hackanddo" />
    <meta name="twitter:title" content="sh vs bash" />
    <meta name="twitter:description" content="Attention à la différence entre bash et sh quand il en vient à l'exploitation de binaires" />
    
    <meta name="twitter:image" content="http://localhost:4000/assets/icones/logo.png" />
    
  
    <!-- Google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  
      ga('create', 'UA-80312745-1', 'auto');
      ga('send', 'pageview');
  
    </script>
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="sh vs bash" />
<meta name="author" content="Pixis" />
<meta property="og:locale" content="fr_FR" />
<meta name="description" content="Attention à la différence entre bash et sh quand il en vient à l’exploitation de binaires" />
<meta property="og:description" content="Attention à la différence entre bash et sh quand il en vient à l’exploitation de binaires" />
<link rel="canonical" href="http://localhost:4000/sh-vs-bash/" />
<meta property="og:url" content="http://localhost:4000/sh-vs-bash/" />
<meta property="og:site_name" content="hackndo" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-11-03T10:12:24+01:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/icones/logo.png"},"name":"Pixis"},"url":"http://localhost:4000/sh-vs-bash/","headline":"sh vs bash","dateModified":"2016-11-03T10:12:24+01:00","datePublished":"2016-11-03T10:12:24+01:00","author":{"@type":"Person","name":"Pixis"},"description":"Attention à la différence entre bash et sh quand il en vient à l’exploitation de binaires","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/sh-vs-bash/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

  <body>
    <header class="cd-main-header">
    <a href="/" class="cd-logo"><img src="/assets/icones/logo.png" /> <span class="cd-logo-title">hackndo</span></a>
		
    <a href="#0" class="cd-nav-trigger">Menu<span></span></a>

</header> <!-- .cd-main-header -->
    <main class="cd-main-content">
		<nav class="cd-side-nav">
            <div class="sidebar-about">
    <h1>
        <img id="site-logo" src="/assets/icones/logo.png" alt="logo" title="logo" />
        <a class="sidebar-title" href="/">
        hackndo
        </a>
    </h1>
    <p class="lead">Think out of the box</p>
</div>

<ul>
    <li class="cd-label">Blog</li>
    <li class="">
        <a href="/">Home</a>
    </li>
    
    
        
            
        
    
        
            
                <li class="">
                    <a href="/about/">À propos</a>
                </li>
            
        
    
        
            
                <li class="">
                    <a href="/archives/">Archives</a>
                </li>
            
        
    
        
            
                <li class="">
                    <a href="/contact/">Me contacter</a>
                </li>
            
        
    
        
            
                <li class="">
                    <a href="/disclaimer/">Disclaimer</a>
                </li>
            
        
    
        
    
        
            
        
    
        
            
                <li class="">
                    <a href="/projects/">Projets</a>
                </li>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
    
        
    
</ul>
<ul>
    <li class="cd-label">Liens</li>
    <li><a href="https://www.dailysecurity.fr/" target="_blank">Blog de Geluchat</a></li>
    <li><a href="http://lsdsecdaemon.com" target="_blank">Blog de Th3_l5D</a></li>
    <li><a href="http://inf0sec.fr" target="_blank">Blog de Matthieu</a></li>
</ul>
<p class="sidebar-copyright">&copy; 2019. Tous droits réservés.</p>
<div class="sidebar-social">
<ul>
  <li><a href="https://twitter.com/HackAndDo" title="Twitter" target="_blank"><img alt="Twitter" title="Twitter" src="/assets/icones/social/twitter.png" /></a></li>
  <li><a href="https://github.com/hackndo" title="Github" target="_blank"><img title="Github" alt="Github" src="/assets/icones/social/github.png" /></a></li>
  <li><a href="https://www.youtube.com/channel/UC9WYWHLdu9TK-0Hu3wcHJ9g" title="Youtube" target="_blank"><img title="Youtube" alt="Youtube" src="/assets/icones/social/youtube.png" /></a></li>
  <li><a href="https://discord.gg/9At6SUZ" title="Discord" target="_blank"><img title="Discord" alt="Discord" src="/assets/icones/social/discord.png" /></a></li>
  <li><a href="https://www.linkedin.com/in/romainbentz/" title="LinkedIn" target="_blank"><img title="LinkedIn" alt="LinkedIn" src="/assets/icones/social/linkedin.png" /></a></li>
  <li><a href="https://sh.hackndo.com" title="Shell" target="_blank"><img title="Shell" alt="Shell" src="/assets/icones/social/shell.png" /></a></li>
  <li><a href="/feed.xml" title="RSS" target="_blank"><img title="RSS" alt="RSS" src="/assets/icones/social/rss.png" /></a></li>
  <li><a href="https://ko-fi.com/hackndo" title="Ko-Fi" target="_blank"><img title="Ko-Fi" alt="Ko-Fi" src="/assets/icones/social/kofi.gif" /></a></li>
</ul>
</div>
        </nav>

        <div class="content-wrapper">
            <div class="post">
  
  <h1 class="post-title">sh vs bash</h1>
  <div class="post-info">
      <p class="alignleft">03 Nov 2016 <a class="post-comments-count" href="http://http://localhost:4000/sh-vs-bash/#disqus_thread"></a></p>
      <p class="alignright">Auteur : <strong><a href="https://twitter.com/HackAndDo">Pixis</a></strong></p>
      <div class="keywords">
        <span class="post-tags"><a href="/archives/#linux"><i class="fas fa-tags"></i> Linux</a><a href="/archives/#misc"><i class="fas fa-tags"></i> Misc</a></span>
      </div>
</div>

  <article>
  <p>J’écris cet article car j’ai constaté à deux reprises un comportement que je ne comprenais pas. L’appel système</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">execve</span><span class="p">(</span><span class="s">"/bin/sh"</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span>
</code></pre></div></div>

<p>me lançait un terminal <code class="highlighter-rouge">bash</code> au lieu de <code class="highlighter-rouge">sh</code>. Comme j’étais en phase d’exploitation avec une élévation de privilèges, et comme <code class="highlighter-rouge">bash</code> <em>drop</em> les droits par défault, je me retrouvais avec un shell qui n’avait plus les droits du binaire.</p>

<p>Voici alors un petit post qui me servira plus de rappel à moi-même qu’autre chose. Les deux ressources citées en fin d’article vous permettront d’aller voir un peu plus loin.</p>

<!--more-->

<p><code class="highlighter-rouge">sh</code> est un langage de programmation décrit par le standard POSIX. Il possède plusieurs implémentations telles que <code class="highlighter-rouge">dash</code>, <code class="highlighter-rouge">ksh</code> etc.
Ainsi, dans la plupart des systèmes d’exploitation, <code class="highlighter-rouge">sh</code> n’étant pas une implémentation, <code class="highlighter-rouge">/bin/sh</code> est un lien symbolique vers une implémentation, souvent <code class="highlighter-rouge">/bin/bash</code>.</p>

<p>Dans mon système d’exploitation actuel, je peux le voir</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/sh -&gt; bash<span class="k">*</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">bash</code> est donc une implémentation de <code class="highlighter-rouge">sh</code>, cependant beaucoup de modules/extensions y ont été ajoutés. Lorsqu’on fait un appel à <code class="highlighter-rouge">/bin/bash</code>, nous avons l’implémentation de <code class="highlighter-rouge">sh</code> avec tout un tas d’extensions.</p>

<p>Cependant, le binaire <code class="highlighter-rouge">/bin/bash</code> a implémenté une vérification sur <code class="highlighter-rouge">argv[0]</code> (contenant la ligne de commande qui a appelé le binaire). Si le binaire a été appelé via <code class="highlighter-rouge">/bin/sh</code>, alors <code class="highlighter-rouge">/bin/bash</code> va essayer d’imiter le comportement des versions historiques de <code class="highlighter-rouge">sh</code>. Les extensions de démarrage de <code class="highlighter-rouge">bash</code> ne seront pas chargées, notamment celle qui fait perdre l’élévation des droits suite à une exécution d’un binaire possédant le bit <code class="highlighter-rouge">SUID</code>.</p>

<p>Voici quelques exemples</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Appel via sh</span>
<span class="nv">$ </span>/bin/sh
sh-3.4 <span class="nv">$ </span>

<span class="c"># Appel via bash</span>
<span class="nv">$ </span>/bin/bash
bash-4.3 <span class="nv">$ </span>

<span class="c"># Appel système execve("/bin/sh", NULL, NULL)</span>
bash-4.3 <span class="nv">$ </span>

<span class="c"># Appel système execve("/bin/sh", ["/bin/sh"], NULL)</span>
sh-3.4 <span class="nv">$ </span>
</code></pre></div></div>

<p>Vous voyez bien avec ces différents exemples que lorsque le binaire <code class="highlighter-rouge">bash</code> est exécuté, si jamais <code class="highlighter-rouge">argv[0]</code> contient le chemin vers <code class="highlighter-rouge">sh</code> alors nous avons une imitation du comportement historique de <code class="highlighter-rouge">sh</code> qui est exécutée. Dans le cas contraire, c’est bien le binaire <code class="highlighter-rouge">bash</code> et toutes ses extensions qui est exécuté.</p>

<p>Voilà pourquoi je perdais les droits pendant mes exploitations. Il me suffit alors de faire en sorte que le deuxième argument de <code class="highlighter-rouge">execve</code> pointe vers un tableau contenant une chaîne de caractères : <code class="highlighter-rouge">"/bin/sh"</code>.</p>

<p><strong>Références</strong></p>

<ul>
  <li><a href="http://www.gnu.org/software/bash/manual/bashref.html#Bash-Startup-Files" target="blank">http://www.gnu.org/software/bash/manual/bashref.html#Bash-Startup-Files</a></li>
  <li><a href="http://stackoverflow.com/questions/5725296/difference-between-sh-and-bash" target="blank">http://stackoverflow.com/questions/5725296/difference-between-sh-and-bash</a></li>
</ul>

  </article>
</div>
<div class="keywords">
    <span class="post-tags"><a href="/archives/#linux"><i class="fas fa-tags"></i> Linux</a><a href="/archives/#misc"><i class="fas fa-tags"></i> Misc</a></span>
  </div>


<br />
<div class="box">
  <div class="dash">
    <div class="picture">
      <img src="/assets/icones/pixis_logo.png" alt="logo" title="logo" />
    </div>
    <div class="box_content">
      <strong>Auteur</strong> : <a href="/contact/" target="_blank">Pixis</a><br />
      Créateur du blog, suivez-moi sur <a href="https://twitter.com/HackAndDo/" target="_blank">twitter</a> ou <a href="https://discord.gg/9At6SUZ" target="blank">discord</a>
    </div>
    
  </div>
</div>


<div class="related">
  <h2>Articles similaires</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/pass-the-hash/">
            Pass the Hash
            <small>18 Dec 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/remote-lsass-dump-passwords/">
            Extraction des secrets de lsass à distance
            <small>28 Nov 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/bloodhound/">
            BloodHound
            <small>30 Jul 2019</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    
    var disqus_config = function () {
        this.page.url = 'http://localhost:4000/sh-vs-bash/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '0000-0000-0000-0017';
    };
    
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//hackndo.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

        </div>
    </main>
    <script src="/assets/js/jquery-2.1.4.js"></script>
    <script src="/assets/js/jquery.menu-aim.js"></script>
    <script src="/assets/js/anchor.min.js"></script>
    <script src="/assets/js/main.js"></script> <!-- Resource jQuery -->
  </body>
</html>